<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="Generator" content="EditPlus®,Microshaoft">
	<meta name="Author" content="EditPlus®,Microshaoft">
	<meta name="Keywords" content="EditPlus®,Microshaoft">
	<meta name="Description" content="EditPlus®,Microshaoft">
	<title>Cross-Browser QRCode generator for Javascript</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<script type="text/javascript" src="jquery.min.js"></script>
	<script type="text/javascript" src="qrcode.js"></script>
	<script type="text/javascript" src="interact.js"></script>

	<style>
		.item {
			cursor: default;
			width: 100%;
			height: 100%;
		}

		.item img {
			width: 100%;
			height: 100%;
			cursor: move;
		}

		.item img:hover {
			opacity: 0.6;
		}

		.resize-drag {
			width: 120px;
			border-radius: 8px;
			padding: 20px;
			margin: 1rem;
			background-color: blue;
			color: white;
			touch-action: none;

			/* This makes things *much* easier */
			box-sizing: border-box;
		}
	</style>
</head>

<body id="body">
	<center>
		<textarea id="text" rows="5" cols="100">♂㊚囍㊛♀
满屏荒唐言
一把辛酸泪
都言作者痴
谁解比特位
~ Duang ~</textarea>
		&nbsp;&nbsp;
		<span id="text-count"></span>
		&nbsp;&nbsp;
		<button id="button" accesskey="q">Generate <strong><u>Q</u></strong>R Code</button>
		<br />

		<h3>
			The QR code display area is draggable and resizeable!
		</h3>

		<div id="container" class="resize-drag" style="width: 700px; height: 700px;">
			<div id="qrcode" class="item" style="display:flex; justify-content: center; align-items: center;">
			</div>
		</div>
	</center>

	<script type="text/javascript">

		interact('.resize-drag')
			.draggable({
				onmove: function (event) {
					var target = event.target,
						// keep the dragged position in the data-x/data-y attributes
						x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
						y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

					// translate the element
					target.style.webkitTransform =
						target.style.transform =
						'translate(' + x + 'px, ' + y + 'px)';

					// update the posiion attributes
					target.setAttribute('data-x', x);
					target.setAttribute('data-y', y);
				}
			})
			.resizable({
				edges: { left: true, right: true, bottom: true, top: true }
			})
			.on('resizemove', function (event) {
				var target = event.target;
				x = (parseFloat(target.getAttribute('data-x')) || 0),
					y = (parseFloat(target.getAttribute('data-y')) || 0);

				// update the element's style
				target.style.width = event.rect.width + 'px';
				target.style.height = event.rect.height + 'px';

				// translate when resizing from top or left edges
				x += event.deltaRect.left;
				y += event.deltaRect.top;

				target.style.webkitTransform = target.style.transform =
					'translate(' + x + 'px,' + y + 'px)';

				target.setAttribute('data-x', x);
				target.setAttribute('data-y', y);
				//target.textContent = event.rect.width + '×' + event.rect.height;
			});

		$("#text-count").text($("#text").val().length);

		$("#text").on("input propertychange", function () {
			var $this = $(this),
				_val = $this.val(),
				count = "";
			count = $this.val().length;
			$("#text-count").text(count);
		});

		var div = document.getElementById("qrcode");
		var qrcode = new QRCode(div, {
			width: div.clientWidth,
			height: div.clientHeight
		});

		function makeCode() {
			var elText = document.getElementById("text");

			if (!elText.value) {
				// alert("Input a text");
				// elText.focus();
				return;
			}
			qrcode.makeCode(elText.value);
		}

		makeCode();

		var timer = null;
		var timeout = 500;
		var alertMessage = "QR code have already been generated!\nEnjoy to scan it to your other device!\nSpecial thanks for Open Source:\n                                                    QRCode.js@davidshimjs";

		$("#text").
			on("blur", function () {
				makeCode();
				if (timeId) {
					clearTimeout(timer);
				}
				timer = setTimeout(function () {
					alert(alertMessage);
				}, timeout);
			});

		$("#button").
			on("click", function () {
				makeCode();
				if (timer) {
					clearTimeout(timer);
				}
				timeId = setTimeout(function () {
					alert(alertMessage);
				}, timeout);
			});	
	</script>
</body>